var p=Object.defineProperty;var u=(a,t,e)=>t in a?p(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var d=(a,t,e)=>u(a,typeof t!="symbol"?t+"":t,e);import{f as g,a as O,g as C}from"./api-qVeSV1hb.js";import{s as E}from"./utils-zbpuQVcp.js";class _{constructor(){d(this,"listeners",[])}register(t){this.listeners.push(t)}dispatch(t){this.listeners.forEach(e=>e(t))}}const l=new _;var r=(a=>(a.FETCH_HUB="FETCH_HUB",a.FETCH_HUB_SUCCESS="FETCH_HUB_SUCCESS",a.FETCH_HUB_ERROR="FETCH_HUB_ERROR",a.FETCH_COLLECTION="FETCH_COLLECTION",a.FETCH_COLLECTION_SUCCESS="FETCH_COLLECTION_SUCCESS",a.FETCH_COLLECTION_ERROR="FETCH_COLLECTION_ERROR",a.UPDATE_FOCUS="UPDATE_FOCUS",a.SHOW_MODAL="SHOW_MODAL",a.CLOSE_MODAL="CLOSE_MODAL",a))(r||{});class S{constructor(){d(this,"listeners",[])}subscribeComponent(t){console.log(t),this.listeners.push(t)}emit(){this.listeners.forEach(t=>t())}}class b extends S{constructor(){super();d(this,"state",{collections:[],currentRow:0,currentCol:0,isModalOpen:!1,loading:!1});this.registerToDispatcher()}registerToDispatcher(){l.register(e=>{switch(e.type){case r.FETCH_HUB:this.state.loading=!0,this.emit();break;case r.FETCH_HUB_SUCCESS:this.state.collections=e.payload.map(c=>E(c)),this.state.loading=!1,this.state.error=void 0,this.emit();break;case r.FETCH_HUB_ERROR:this.state.error=e.payload,this.state.loading=!1,this.emit();break;case r.UPDATE_FOCUS:const{row:s,col:o}=e.payload;this.state.currentRow=s,this.state.currentCol=o,this.emit();break;case r.SHOW_MODAL:this.state.currentItem=e.payload,this.state.isModalOpen=!0,this.emit();break;case r.CLOSE_MODAL:this.state.isModalOpen=!1,this.emit();break;case r.FETCH_COLLECTION_SUCCESS:const i=e.payload,n=this.state.collections.map(c=>c.id===i.id?E(i):c);this.state.collections=[...n],this.emit();break;case r.FETCH_COLLECTION_ERROR:console.error("Failed to fetch collection:",e.payload);break}})}getState(){return{...this.state}}getMaxRows(){return this.state.collections.length}getMaxCols(e){var s;return((s=this.state.collections[e])==null?void 0:s.items.length)??0}}const h=new b,m={async fetchHub(){l.dispatch({type:r.FETCH_HUB});try{const a=await g();l.dispatch({type:r.FETCH_HUB_SUCCESS,payload:a.components})}catch(a){l.dispatch({type:r.FETCH_HUB_ERROR,payload:a})}},updateFocus(a,t){l.dispatch({type:r.UPDATE_FOCUS,payload:{row:a,col:t}})},showModal(a){l.dispatch({type:r.SHOW_MODAL,payload:a})},closeModal(){l.dispatch({type:r.CLOSE_MODAL})},async fetchCollection(a){l.dispatch({type:r.FETCH_COLLECTION});try{const t=await O(a);l.dispatch({type:r.FETCH_COLLECTION_SUCCESS,payload:t})}catch(t){l.dispatch({type:r.FETCH_COLLECTION_ERROR,payload:t})}}};class w{constructor(){d(this,"content");d(this,"modal");d(this,"intersectionObserver");this.content=document.getElementById("content"),this.modal=document.getElementById("modal"),this.setupKeyboardNavigation(),h.subscribeComponent(()=>this.render()),this.intersectionObserver=this.setupInfinitieScroll()}async init(){await m.fetchHub()}render(){const t=h.getState();if(t.loading){this.content.innerHTML="<p>Loading...</p>";return}if(t.error){this.renderError(t.error);return}this.renderCollections(t.collections),this.updateFocus(t.currentRow,t.currentCol),t.isModalOpen&&t.currentItem?this.showModal(t.currentItem):this.closeModal()}renderImage(t,e){return t.items.map((s,o)=>{var i;return`
      <div class="item" data-row="${e}" data-col="${o}">
        <div class="item-image">
          <img src="${C(s.image,400,200)}"
              alt="${s.title} poster"
              onerror="this.src='${C(s.logo,200,200)}'; this.alt='image-failed'"
              loading="lazy">
          ${s.watermark?`<img class="item-image-watermark" 
                 src="${C(s.watermark,100,100)}" 
                 alt="watermark">`:""}
        </div>
        <h2 class="item-title">${s.title}</h2>
        <h3 class="item-subtitle">${(s==null?void 0:s.rating)??"No rating"} &#8226; ${s.genre} &#8226; ${((i=s.premiereDate)==null?void 0:i.substring(0,4))??""}</h3>
      </div>
    `}).join("")}renderCollections(t){this.content.innerHTML=t.map((e,s)=>{var o;return`
          <div class="collection" data-row="${s}" data-id="${e.id}" aria-label="${e.name} collection">
            <h1 id="collection-${e.id}" class="collection-title">${(o=e.name)==null?void 0:o.toLocaleUpperCase()}</h1>
            <div class="items-row" role="list" aria-labelledby="collection-${e.id}">
                ${this.renderImage(e,s)}
            </div>
          </div>
        `}).join(""),document.querySelectorAll(".collection").forEach(e=>{e.getAttribute("data-id")&&this.intersectionObserver.observe(e)})}setupKeyboardNavigation(){document.addEventListener("keydown",t=>{var i;const e=h.getState();let s=e.currentRow,o=e.currentCol;if(e.isModalOpen){(t.key==="Escape"||t.key==="Backspace")&&m.closeModal();return}switch(t.key){case"ArrowUp":s>0&&s--;break;case"ArrowDown":s<h.getMaxRows()-1&&s++;break;case"ArrowLeft":o>0&&o--;break;case"ArrowRight":o<h.getMaxCols(s)-1&&o++;break;case"Enter":const n=(i=e.collections[s])==null?void 0:i.items[o];n&&m.showModal(n);return}m.updateFocus(s,o)})}updateFocus(t,e){const s=document.querySelector(".item.focused"),o=document.querySelector(`.item[data-row="${t}"][data-col="${e}"]`);s==null||s.classList.remove("focused"),s==null||s.setAttribute("aria-selected","false"),o&&(o.classList.add("focused"),o.setAttribute("aria-selected","true"),o.focus(),o.scrollIntoView({block:"center"}))}showModal(t){const e=document.getElementById("modal-collection-title"),s=document.getElementById("modal-collection-genre"),o=document.getElementById("modal-collection-description"),i=document.getElementById("modal-collection-image");e.textContent=t.title,s.textContent=t.genre||"",o.textContent=t.description,i.src=C(t.image,400,200),i.onerror=function(){this.src=C(t.logo,400,200)},this.modal.setAttribute("aria-labelledby",`modal-${t.title}`),this.modal.setAttribute("aria-describedby","modal-collection-description modal-collection-genre"),this.modal.classList.add("active")}closeModal(){this.modal.classList.remove("active"),this.modal.setAttribute("aria-hidden","true")}setupInfinitieScroll(){return new IntersectionObserver(t=>{t.forEach(e=>{var i;const s=h.getState(),o=new Map(s.collections.map(n=>[n.id,n]));if(e.isIntersecting){const c=e.target.dataset.id;c&&!((i=o.get(c))!=null&&i.items.length)&&(m.fetchCollection(c),this.intersectionObserver.unobserve(e.target))}})},{root:null,rootMargin:"100px",threshold:.1})}renderError(t){this.content.innerHTML=`
      <p>Failed to load content. Please try again later.</p>
      <p>Error: ${t}</p>
    `}}export{w as U};
