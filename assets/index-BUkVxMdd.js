var g=Object.defineProperty;var E=(r,e,t)=>e in r?g(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>E(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const C="https://d1q0vy0v52gyjr.cloudfront.net";async function f(){const r=await fetch(`${C}/hub.json`);if(!r.ok)throw new Error("Failed to fetch hub data");return r.json()}function u(r,e,t){return r?`${r}&size=${e}x${t}&format=webp`:""}async function O(r){const e=await fetch(`${C}/collections/${r}.json`);if(!e.ok)throw new Error(`Failed to fetch collection ${r}`);return e.json()}class _{constructor(){d(this,"listeners",[])}register(e){this.listeners.push(e)}dispatch(e){this.listeners.forEach(t=>t(e))}}const c=new _;var i=(r=>(r.FETCH_HUB="FETCH_HUB",r.FETCH_HUB_SUCCESS="FETCH_HUB_SUCCESS",r.FETCH_HUB_ERROR="FETCH_HUB_ERROR",r.FETCH_COLLECTION="FETCH_COLLECTION",r.FETCH_COLLECTION_SUCCESS="FETCH_COLLECTION_SUCCESS",r.FETCH_COLLECTION_ERROR="FETCH_COLLECTION_ERROR",r.UPDATE_FOCUS="UPDATE_FOCUS",r.SHOW_MODAL="SHOW_MODAL",r.CLOSE_MODAL="CLOSE_MODAL",r))(i||{});class b{constructor(){d(this,"listeners",[])}subscribeComponent(e){console.log(e),this.listeners.push(e)}emit(){this.listeners.forEach(e=>e())}}function p(r){return{id:r.id,name:r.name,items:r.items.map(e=>{var t,s,o;return{id:e.id,title:e.visuals.headline,description:e.visuals.body,rating:e.entity_metadata.rating.code,genre:(t=e.entity_metadata.genre_names)==null?void 0:t.join(", "),image:e.visuals.artwork.horizontal_tile.image.path,premiereDate:e.entity_metadata.premiere_date,watermark:((s=e.visuals.primary_branding)==null?void 0:s.artwork["brand.watermark.bottom.right"].path)??"",logo:(o=e.visuals.primary_branding)==null?void 0:o.artwork["brand.logo"].path}})}}class y extends b{constructor(){super();d(this,"state",{collections:[],currentRow:0,currentCol:0,isModalOpen:!1,loading:!1});this.registerToDispatcher()}registerToDispatcher(){c.register(t=>{switch(t.type){case i.FETCH_HUB:this.state.loading=!0,this.emit();break;case i.FETCH_HUB_SUCCESS:this.state.collections=t.payload.map(l=>p(l)),this.state.loading=!1,this.state.error=void 0,this.emit();break;case i.FETCH_HUB_ERROR:this.state.error=t.payload,this.state.loading=!1,this.emit();break;case i.UPDATE_FOCUS:const{row:s,col:o}=t.payload;this.state.currentRow=s,this.state.currentCol=o,this.emit();break;case i.SHOW_MODAL:this.state.currentItem=t.payload,this.state.isModalOpen=!0,this.emit();break;case i.CLOSE_MODAL:this.state.isModalOpen=!1,this.emit();break;case i.FETCH_COLLECTION_SUCCESS:const a=t.payload,n=this.state.collections.map(l=>l.id===a.id?p(a):l);this.state.collections=[...n],this.emit();break;case i.FETCH_COLLECTION_ERROR:console.error("Failed to fetch collection:",t.payload);break}})}getState(){return{...this.state}}getMaxRows(){return this.state.collections.length}getMaxCols(t){var s;return((s=this.state.collections[t])==null?void 0:s.items.length)??0}}const h=new y,m={async fetchHub(){c.dispatch({type:i.FETCH_HUB});try{const r=await f();c.dispatch({type:i.FETCH_HUB_SUCCESS,payload:r.components})}catch(r){c.dispatch({type:i.FETCH_HUB_ERROR,payload:r})}},updateFocus(r,e){c.dispatch({type:i.UPDATE_FOCUS,payload:{row:r,col:e}})},showModal(r){c.dispatch({type:i.SHOW_MODAL,payload:r})},closeModal(){c.dispatch({type:i.CLOSE_MODAL})},async fetchCollection(r){c.dispatch({type:i.FETCH_COLLECTION});try{const e=await O(r);c.dispatch({type:i.FETCH_COLLECTION_SUCCESS,payload:e})}catch(e){c.dispatch({type:i.FETCH_COLLECTION_ERROR,payload:e})}}};class w{constructor(){d(this,"content");d(this,"modal");d(this,"intersectionObserver");this.content=document.getElementById("content"),this.modal=document.getElementById("modal"),this.setupKeyboardNavigation(),h.subscribeComponent(()=>this.render()),this.intersectionObserver=this.setupInfinitieScroll()}async init(){await m.fetchHub()}render(){const e=h.getState();if(e.loading){this.content.innerHTML="<p>Loading...</p>";return}if(e.error){this.renderError(e.error);return}this.renderCollections(e.collections),this.updateFocus(e.currentRow,e.currentCol),e.isModalOpen&&e.currentItem?this.showModal(e.currentItem):this.closeModal()}renderImage(e,t){return e.items.map((s,o)=>{var a;return`
      <div class="item" data-row="${t}" data-col="${o}">
        <div class="item-image">
          <img src="${u(s.image,400,200)}"
              alt="${s.title} poster"
              onerror="this.src='${u(s.logo,200,200)}'; this.alt='image-failed'"
              loading="lazy">
          ${s.watermark?`<img class="item-image-watermark" 
                 src="${u(s.watermark,100,100)}" 
                 alt="watermark">`:""}
        </div>
        <h2 class="item-title">${s.title}</h2>
        <h3 class="item-subtitle">${(s==null?void 0:s.rating)??"No rating"} &#8226; ${s.genre} &#8226; ${((a=s.premiereDate)==null?void 0:a.substring(0,4))??""}</h3>
      </div>
    `}).join("")}renderCollections(e){this.content.innerHTML=e.map((t,s)=>{var o;return`
          <div class="collection" data-row="${s}" data-id="${t.id}" aria-label="${t.name} collection">
            <h1 id="collection-${t.id}" class="collection-title">${(o=t.name)==null?void 0:o.toLocaleUpperCase()}</h1>
            <div class="items-row" role="list" aria-labelledby="collection-${t.id}">
                ${this.renderImage(t,s)}
            </div>
          </div>
        `}).join(""),document.querySelectorAll(".collection").forEach(t=>{t.getAttribute("data-id")&&this.intersectionObserver.observe(t)})}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{var a;const t=h.getState();let s=t.currentRow,o=t.currentCol;if(t.isModalOpen){(e.key==="Escape"||e.key==="Backspace")&&m.closeModal();return}switch(e.key){case"ArrowUp":s>0&&s--;break;case"ArrowDown":s<h.getMaxRows()-1&&s++;break;case"ArrowLeft":o>0&&o--;break;case"ArrowRight":o<h.getMaxCols(s)-1&&o++;break;case"Enter":const n=(a=t.collections[s])==null?void 0:a.items[o];n&&m.showModal(n);return}m.updateFocus(s,o)})}updateFocus(e,t){const s=document.querySelector(".item.focused"),o=document.querySelector(`.item[data-row="${e}"][data-col="${t}"]`);s==null||s.classList.remove("focused"),s==null||s.setAttribute("aria-selected","false"),o&&(o.classList.add("focused"),o.setAttribute("aria-selected","true"),o.focus(),o.scrollIntoView({block:"center"}))}showModal(e){const t=document.getElementById("modal-collection-title"),s=document.getElementById("modal-collection-genre"),o=document.getElementById("modal-collection-description"),a=document.getElementById("modal-collection-image");t.textContent=e.title,s.textContent=e.genre||"",o.textContent=e.description,a.src=u(e.image,400,200),a.onerror=function(){this.src=u(e.logo,400,200)},this.modal.setAttribute("aria-labelledby",`modal-${e.title}`),this.modal.setAttribute("aria-describedby","modal-collection-description modal-collection-genre"),this.modal.classList.add("active")}closeModal(){this.modal.classList.remove("active"),this.modal.setAttribute("aria-hidden","true")}setupInfinitieScroll(){return new IntersectionObserver(e=>{e.forEach(t=>{var a;const s=h.getState(),o=new Map(s.collections.map(n=>[n.id,n]));if(t.isIntersecting){const l=t.target.dataset.id;l&&!((a=o.get(l))!=null&&a.items.length)&&(m.fetchCollection(l),this.intersectionObserver.unobserve(t.target))}})},{root:null,rootMargin:"100px",threshold:.1})}renderError(e){this.content.innerHTML=`
      <p>Failed to load content. Please try again later.</p>
      <p>Error: ${e}</p>
    `}}document.addEventListener("DOMContentLoaded",()=>{new w().init()});
